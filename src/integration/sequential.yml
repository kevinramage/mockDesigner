name: Sequential
vars:
  host: "localhost"
testcases:

# Build mock
- name: BuildMockService
  steps:
  - type: exec
    script: npm run start -- --input tests/code/examples/sequential.yml
    assertions:
    - result.code ShouldEqual 0
  - type: exec
    script: docker-compose -f generated/docker-compose.yml up -d --build
  - type: exec
    script: sleep 10
  - type: http
    method: GET
    url: "http://{{.host}}:7001/api/v1/myService/_ping"
    assertions:
    - result.statuscode ShouldEqual 204

# Nominal case
- name: NominalCase
  steps:
  - type: http
    method: POST
    url: "http://{{.host}}:7001/api/v1/myService"
    assertions:
    - result.statuscode ShouldEqual 200
    - result.body ShouldEqual "Operation completed successfully"
  - type: http
    method: POST
    url: "http://{{.host}}:7001/api/v1/myService"
    assertions:
    - result.statuscode ShouldEqual 200
    - result.body ShouldEqual "Operation completed successfully"
  - type: http
    method: POST
    url: "http://{{.host}}:7001/api/v1/myService"
    assertions:
    - result.statuscode ShouldEqual 200
    - result.body ShouldEqual "Operation completed successfully"
  - type: http
    method: POST
    url: "http://{{.host}}:7001/api/v1/myService"
    assertions:
    - result.statuscode ShouldEqual 400
    - result.body ShouldEqual "Request sent invalid"
  - type: http
    method: POST
    url: "http://{{.host}}:7001/api/v1/myService"
    assertions:
    - result.statuscode ShouldEqual 400
    - result.body ShouldEqual "Request sent invalid"
  - type: http
    method: POST
    url: "http://{{.host}}:7001/api/v1/myService"
    assertions:
    - result.statuscode ShouldEqual 500
    - result.body ShouldEqual "An internal error occured"
  - type: http
    method: POST
    url: "http://{{.host}}:7001/api/v1/myService"
    assertions:
    - result.statuscode ShouldEqual 200
    - result.body ShouldEqual "Operation completed successfully"