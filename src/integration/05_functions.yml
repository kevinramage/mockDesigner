name: Functions
vars:
  host: "localhost"
  port: 7005
  output: generated_functions
testcases:

# Build mock
- name: BuildMockService
  steps:
  - type: exec
    script: npm run start -- --input mocks/code/examples/functions.yml --port {{.port}} --output {{.output}}
    assertions:
    - result.code ShouldEqual 0
  - type: exec
    script: docker-compose -f {{.output}}/docker-compose.yml up -d --force-recreate 
  - type: exec
    script: ./wait {{.output}}_was_1
  - type: http
    method: GET
    url: "http://{{.host}}:{{.port}}/api/v1/functionService/_ping"
    assertions:
    - result.statuscode ShouldEqual 204

# Nominal case
- name: NominalCase
  steps:
  - type: http
    method: POST
    headers:
      Content-Type: "application/json"
    body: "{ \"username\": \"Kevin\" }"
    url: "http://{{.host}}:{{.port}}/api/v1/functionService"
    assertions:
    - result.statuscode ShouldEqual 200
    - result.bodyjson.id ShouldEqual 1
    - result.bodyjson.increment ShouldNotBeNil
    - result.bodyjson.uniquestring ShouldNotBeNil
    - result.bodyjson.uniquevalue ShouldNotBeNil
    - result.bodyjson.currentdate ShouldNotBeNil
    - result.bodyjson.randominteger ShouldNotBeNil
    - result.bodyjson.randomstring ShouldNotBeNil
    - result.bodyjson.uppercaseconstant ShouldEqual TEST
    - result.bodyjson.uppercaserequest ShouldEqual KEVIN
    - result.bodyjson.lowercaseconstant ShouldEqual test
    - result.bodyjson.lowercaserequest ShouldEqual kevin
    - result.bodyjson.helloworld ShouldEqual "Hello Kevin"